#define _GNU_SOURCE
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/uio.h>

#include "secure_lib.h"

int main(int argc, char **argv) {
    secure_lib_init();
    secure_lib_print_secret();

    char secret[128];

    struct iovec local_iov, remote_iov;

    local_iov.iov_base = &secret;
    local_iov.iov_len = sizeof(secret);

    remote_iov.iov_base = secure_lib_secret;
    remote_iov.iov_len = local_iov.iov_len;

    process_vm_readv(getpid(), &local_iov, 1, &remote_iov, 1, 0);

    fprintf(stderr, "TRYING TO STEAL THE SECRET: %s\n", secret);

    return 0;
}

