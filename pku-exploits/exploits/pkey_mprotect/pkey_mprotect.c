#include <stdio.h>
#include <erim.h>

#include "secure_lib.h"

#define PAGE_MASK (~(PAGE_SIZE - 1))

#define PAGE_ALIGN(A) (((unsigned long long)A) & PAGE_MASK)

int main(int argc, char **argv) {
    int r;
    secure_lib_init();
    secure_lib_print_secret();

    r = pkey_mprotect((void*)PAGE_ALIGN(secure_lib_secret), PAGE_SIZE, PROT_READ|PROT_WRITE, 0);

    printf("pkey_mprotect() = %d\n", r);

    fprintf(stderr, "TRYING TO STEAL THE SECRET: %s\n", secure_lib_secret);

    return 0;
}

